syntax = "proto3";

package storage;

option go_package = "github.com/Nikita-Smirnov-idk/Antiplagiat_System/services/storage_service/gen/go;storagepb";

// Meta data of file
message FileMetadata {
  string filename = 1;      // Name of file
  string student_id = 2;    // ID of student
  string task_id = 3;       // ID of task
  int64 size = 4;           // File size in bytes
}

// Chunk of file
message FileChunk {
  bytes data = 1;           // chunk
}

// Response after file was uploaded
message UploadResponse {
  string file_id = 1;       // Unique file ID
  bool success = 2;         // Transfer status (success/error)
  string error = 3;         // Error info in case of error
}

// Service for storing files
service FileStoringService {
  // Client-streaming RPC
  rpc UploadFile(stream UploadRequest) returns (UploadResponse) {}

  // File download RPC
  rpc DownloadFile(DownloadRequest) returns (stream DownloadResponse) {}
}

// Request for client-streaming
message UploadRequest {
  oneof content {
    FileMetadata metadata = 1;  // Meta data
    FileChunk chunk = 2;        // Chunk
  }
}

// Request for downloading
message DownloadRequest {
  string file_id = 1;
}

// Response after download
message DownloadResponse {
  bytes data = 1;
}